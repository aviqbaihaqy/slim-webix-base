var DappurMedia=new function(){this.managerUrl=null,this.getFolderUrl=null,this.addFolderUrl=null,this.deleteMediaUrl=null,this.loadMedia=function(e,t){switch($("#media-modal-body").html(""),e){case"menu":$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="475px" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+'?source=menu"></iframe>');break;case"input":$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="475px" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+"?source=input&target="+t+'"></iframe>')}$("#media-modal").modal("show")},this.createFolder=function(e){var t=this.addFolderUrl;swal({title:"Create a New Folder",input:"text",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:function(a){return new Promise(function(i,l){DappurCSRF.csrfAjax(t,{current_folder:e,new_folder_name:a},function(e){if(parsed=jQuery.parseJSON(e),"error"==parsed.result){var t="";$.each(parsed.data,function(e,a){t=t+"<br />"+a}),l(t)}else"success"==parsed.result?i():l("An unknown error occured.")})})},allowOutsideClick:!1}).then(function(t){DappurMedia.getFolder(e+"/"+t),swal({type:"success",title:"New folder created successfully!",html:e+"/"+t})}).catch(swal.noop)},this.deleteMedia=function(e,t){var a=this.deleteMediaUrl;swal({title:"Are you sure you want to delete this file?",text:"You won't be able to revert this!",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel!",confirmButtonClass:"btn btn-success",cancelButtonClass:"btn btn-danger",buttonsStyling:!0,preConfirm:function(i){return new Promise(function(i,l){DappurCSRF.csrfAjax(a,{current_folder:e,current_file:t},function(e){if(parsed=jQuery.parseJSON(e),"error"==parsed.result){var t="";$.each(parsed.data,function(e,a){t=t+"<br />"+a}),l(t)}else"success"==parsed.result?i():l("An unknown error occured.")})})},allowOutsideClick:!1}).then(function(a){DappurMedia.getFolder(e),$("#media-modal-info").modal("hide"),swal({type:"success",title:"File was removed successfully! Yay you!",html:e+"/"+t})}).catch(swal.noop)},this.getFolder=function(e){$("#loader").show(),$("#folder_list").html(""),$("#file_list").html(""),DappurCSRF.csrfAjax(this.getFolderUrl,{directory:e},function(t){if(parsed=jQuery.parseJSON(t),$("#breadcrumb").html(""),$("#folder_list").html(""),$("#file_list").html(""),$("#breadcrumb").data("current",e),""==e)$("#breadcrumb").html("/ &nbsp;<li>uploads</li>");else{$("#breadcrumb").html("/ &nbsp;<li>uploads</li>");var a=e.split("/");$.each(a,function(e,t){""!=t&&$("#breadcrumb").append("<li>"+t+"</li>")})}""!=e?$("#back-button").show():$("#back-button").hide(),"error"==parsed.status&&swal("Oops...","You do not have permission to access that folder!","error"),$("#loader").hide(),$.each(parsed.folders,function(e,t){$("#folder_list").append('<div class="col-sm-2 col-xs-4 media-folder" data-folder="'+t+'" style="margin-bottom: 20px;"><div style="line-height: 100px;"><div style="height: 100px; width: 100px; margin: 0 auto 0 auto;"><i class="fa fa-folder" style="font-size: 100px;"></i></div></div><div>'+t+"</div></div>")}),$.each(parsed.files,function(t,a){"image"==a.type?$("#file_list").append('<div class="col-sm-2 col-xs-4 media-file" data-file="'+a.file+'" data-filetype="'+a.type+'" style="margin-bottom: 20px; height: 150px; word-break: break-all;"><div style="line-height: 100px;"><img src="/uploads'+e+"/"+a.file+'" style="max-width: 100%; max-height: 100px; border-radius: 5px; margin-bottom: 5px;" /></div><div>'+a.file+"</div></div>"):$("#file_list").append('<div class="col-sm-2 col-xs-4 media-file" data-file="'+a.file+'" data-filetype="'+a.type+'" style="margin-bottom: 20px; height: 150px; word-break: break-all;"><div style="line-height: 100px;"><div style="height: 100px; width: 100px; margin: 0 auto 5px auto;"><i class="fa fa-file" style="font-size: 100px;"></i></div></div><div>'+a.file+"</div></div>")})})},this.getUrlParameter=function(e){var t,a,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(a=0;a<i.length;a++)if((t=i[a].split("="))[0]===e)return void 0===t[1]||t[1]},this.copyToClipboard=function(e){var t="mycustom-clipboard-textarea-hidden-id",a=document.getElementById(t);if(!a){var i=document.createElement("textarea");i.id=t,i.style.position="fixed",i.style.top=0,i.style.left=0,i.style.width="1px",i.style.height="1px",i.style.padding=0,i.style.border="none",i.style.outline="none",i.style.boxShadow="none",i.style.background="transparent",document.querySelector("body").appendChild(i),a=document.getElementById(t)}a.value=e,a.select()},$(document).on("click","#media-menu",function(){DappurMedia.loadMedia("menu",null)}),$(document).on("dblclick",".media-folder",function(){var e=$("#breadcrumb").data("current")+"/"+$(this).data("folder");DappurMedia.getFolder(e)}),$(document).on("click","#back-button",function(){var e=$("#breadcrumb").data("current").split("/");e.splice(-1,1),newFolder=e.join("/"),DappurMedia.getFolder(newFolder)}),$(document).on("click","#refresh-button",function(){var e=$("#breadcrumb").data("current");DappurMedia.getFolder(e)}),$(document).on("click","#new-folder-button",function(){var e=$("#breadcrumb").data("current");DappurMedia.createFolder(e)}),$(document).on("dblclick",".media-file",function(){var e=$("#breadcrumb").data("current"),t=$(this).data("file"),a=$(this).data("filetype"),i=document.origin+"/uploads"+e+"/"+t;$("#file-info").data("file",t).data("filepath",i).html(t),"image"==a&&$("#media-image-preview").html('<img src="/uploads/'+e+"/"+t+'" style="max-width: 100%; max-height: 200px;" />'),$("#file-name").html(t),$("#file-path").html(i),$("#media-clipboard").val(i),$("#media-download-file").attr("href",i),$("#media-modal-info").modal("show"),new Clipboard("#media-info-btn-copy")}),$(document).on("hidden.bs.modal","#media-modal-info",function(){$("#media-image-preview").html(""),$("#file-name").html(""),$("#file-path").html(""),$("#file-info").data("file","").html(""),$("#media-clipboard").val(""),$("#media-download-file").attr("href","")}),$(document).on("click","#media-info-btn-copy",function(){var e=$("#file-info").data("filepath");DappurMedia.copyToClipboard(e),swal({title:'<span style="color: green;">Image url copied to clipboard!</span>',text:e}).catch(swal.noop)}),$(document).on("click","#media-info-btn-download",function(){document.getElementById("media-download-file").click()}),$(document).on("click","#media-info-btn-delete",function(){var e=$("#breadcrumb").data("current"),t=$("#file-info").data("file");DappurMedia.deleteMedia(e,t)}),$(document).on("click",".image-preview",function(e){e.preventDefault();var t=$(this).attr("data-target");swal({html:'<img src="'+$("#"+t).val()+'" style="width: 100%;">'}).catch(swal.noop)}),$(document).on("click","#upload-button",function(){var e=$("#breadcrumb").data("current");$("#current_folder").val(e),$("#fileupload").trigger("click"),$("#fileupload").fileupload({autoUpload:!0,singleFileUploads:!1,done:function(t,a){DappurMedia.getFolder(e),$.getJSON("/csrf",function(e){$("input[name="+e.name_key+"]").val(e.name),$("input[name="+e.value_key+"]").val(e.value)})}})}),$(document).ready(function(){$(".dm-input").each(function(){var e=$(this).data("name"),t=$(this).data("value");$(this).html('<span class="input-group-btn"><img id="'+e+'-thumbnail" src="'+t+'" style="max-height: 30px; max-width: 30px;" /></span><input type="text" name="'+e+'" id="'+e+'" class="form-control" value="'+t+'"><span class="input-group-btn"><button type="button" class="btn btn-default image-preview" data-target="'+e+'"><i class="fa fa-eye"></i></button><button type="button" class="btn btn-default image-select" data-target="'+e+'"><i class="fa fa-picture-o"></i></button></span>')});var e;try{DappurCloudinary,e=!0}catch(e){}e?$(".image-select").on("click",function(e){e.preventDefault(),DappurCloudinary.loadCloudinary("input",$(this).attr("data-target"))}):$(".image-select").on("click",function(e){e.preventDefault(),DappurMedia.loadMedia("input",$(this).attr("data-target"))}),$(document).on("click","#media-info-btn-insert",function(){var e=$("#file-info").data("filepath"),t=DappurMedia.getUrlParameter("target");$(parent.document).find("#"+t).val(e),$(parent.document).find("#"+t+"-thumbnail").attr("src",e),window.parent.$("#media-modal").modal("hide")})})};